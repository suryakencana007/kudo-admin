;(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}
function Class(){this._type="instance";if(!initializing&&this.init)
this.init.apply(this,arguments);}
Class.prototype=prototype;Class._type="class";Class.prototype.constructor=Class;Class.extend=arguments.callee;return Class;};})();(function(window,$,Class){'use strict';var document=window.document,location=window.location;var ns=function(ns,value){var path=ns.split('.'),obj=window,i,l,prop,last;for(i=0,l=path.length;i<l;++i){prop=path[i];last=i===l-1;if(obj[prop]===undefined){obj[prop]=last&&value?value:{};}else{if($.type(obj[prop])!=='object')throw new Error(prop+' is not object.');if(last&&value){if($.type(value)==='object'){$.extend(true,obj[prop],value);}else throw new Error(value+' value cannot extend.');}}
obj=obj[prop];}
obj.ns||(obj.ns=ns.toLowerCase().replace(/\.(\w)/g,function(_,$1){return $1.toUpperCase();}));Â return obj;};ns('baka',{w:$(window),d:$(document),h:$('html'),ua:{},ns:ns});(function(){var supported=!!window.console;baka.log=supported?function(){if(!arguments.length)return;var args=$.makeArray(arguments);args.unshift(new Date().toTimeString().slice(0,8));'apply'in console.log?console.log.apply(console,args):console.dir?console.dir(args):console.log(args);}:function(){if(!arguments.length)return;var args=$.makeArray(arguments);args.unshift(new Date().toTimeString().slice(0,8));$('#console').append(args.join(' '));};supported||(window.console={log:function(){}});var makeLogFunc=function(level,name){var prefix=level+' ['+name+']';return function(){if(!arguments.length)return;var args=$.makeArray(arguments);args.unshift(prefix);};};var makeLogger=function(name){return{setDefaultLevel:function(){},trace:makeLogFunc('trace',name),debug:makeLogFunc('debug',name),info:makeLogFunc('info',name),warn:makeLogFunc('warn',name),error:makeLogFunc('error',name)};};baka.logger=function(name){if(!baka.logger.loggers[name]){baka.logger.loggers[name]=makeLogger(name);}
return baka.logger.loggers[name];};baka.logger.loggers={};})();})(window,jQuery,Class);baka.ns('kara.fun',{listObj:null,setup:function(object,prop){var objs=this.findMap(object);baka.logger('kara.fun').debug(objs);this.listObj=[];this.splitInit(objs,prop);return this.listObj;},findMap:function(object){return _.map(object,function(val,key){return _.assign({'name':key},val);});},find:function(obj,prop){if(obj instanceof Object&&$.type(obj)==='object'){return _.filter(obj,function(o){if(o===null){return false;}else{return o[prop];}});}
return false;},splitInit:function(objs,prop){for(var obj in objs){if(objs[obj]instanceof Object&&$.type(objs[obj])==='object'){var find_it=this.find(objs[obj],prop);if(find_it.length>0){this.listObj.push(find_it);}
this.splitInit(objs[obj],prop);}}}});kara.app=Class.extend({init:function(opts){$.extend(this,opts);this.setupReady();},setupReady:function(){_.flatMap(kara.fun.setup(kara,'init'),function(clsObj){for(var obj in clsObj){clsObj[obj].init();}});baka.d.on('click','._action',function(e){e.preventDefault();kara.ui.actions.do(this);});$('._action').on('click',function(e){e.preventDefault();kara.ui.actions.do(this);});baka.d.on('click','form._ajax input[type=submit]',function(e){e.preventDefault();baka.logger('kara.app').debug('form._ajax');kara.ui.forms.submit($(this).closest('form._ajax'));});}});$(document).ready(function(){new kara.app()});baka.ns('kara.ui.helpers',{get_action_url:function(options){var container=$(kara.ui.container.get_container());var url=options.url;var param_name=options.param?options.param:'id';switch(options.property){case('with_row'):var row=kara.ui.container.get_selected(container);if(!row){kara.ui.actions.dialog_url('/system_need_select_row');return;}
if(url.indexOf('?')==-1)url=url+'?'+param_name+'='+row[param_name];else url=url+'&'+param_name+'='+row[param_name];break;case('with_rows'):var rows=kara.ui.container.get_checked(container);if(!rows.length){kara.ui.actions.dialog_url('/system_need_select_rows');return;}
var params=Array();$.each(rows,function(i,row){params.push(row[param_name]);});if(url.indexOf('?')==-1)url=url+'?'+param_name+'='+params.join();else url=url+'&'+param_name+'='+params.join();break;}
var params_str=options.params_str?options.params_str:null;if(params_str){if(url.indexOf('?')==-1)url=url+'?'+params_str;else url=url+'&'+params_str;}
return url;},get_params_str:function(options){var params_str=options.params_str?options.params_str:null;if($.isFunction(params_str)){params_str=params_str();}
console.log(params.str);return params_str;},disable_inputs:function(data){var form=$(data).find('form');if(form.hasClass('readonly')){var d=$('<div>').html(data);d=this.disable_obj_inputs(d);return d.html();}
return data;},disable_obj_inputs:function(obj){obj.find(":input").attr("disabled",true);obj.find("[type=reset]").attr("disabled",false);obj.find("[type=submit]").addClass("disable");return obj;},clear_inputs:function(selector){$(selector).find('.easyui-datebox').datebox('clear');$(selector).find('.easyui-datetimebox').datetimebox('clear');$(selector).find('.easyui-combobox').combobox('clear');$(selector).find('.easyui-combogrid').combogrid('clear');$(selector).find('.easyui-combotree').combotree('clear');$(selector).find('.easyui-numberbox').numberbox('clear');},add_datebox_clear_btn:function(selector){var datebox_buttons=$.extend([],$.fn.datebox.defaults.buttons);datebox_buttons.splice(1,0,{text:'Clear',handler:function(target){$(target).datebox('clear');}});$(selector).datebox({buttons:datebox_buttons});},add_datetimebox_clear_btn:function(selector){var datetimebox_buttons=$.extend([],$.fn.datetimebox.defaults.buttons);datetimebox_buttons.splice(1,0,{text:'Clear',handler:function(target){$(target).datetimebox('clear');}});$(selector).datetimebox({buttons:datetimebox_buttons});},get_higher_zindex:function(){var highest=-999;$("*").each(function(){var current=parseInt($(this).css("z-index"),10);if(current&&highest<current)highest=current;});return highest;},getKeyByValue:function(obj,value){var key=null;for(var name in obj){if(obj.hasOwnProperty(name)&&obj[name]===value){key=name;break;}}
return key;},payment_indicator:function(percent){var text=$('<span>').html(percent+'%');if(percent>100)percent=100;var el=$('<div>').css('width',percent+'%').html('&nbsp;');el=$('<div>').addClass('payment-indicator tc').css('width','100%').append(text).append(el);el=$('<div>').append(el);return el.html();},dt_formatter:function(date,format){return Date.format(date,format);},dt_parser:function(s,format){if(!s)return new Date();return Date.parseFormatted(s,format);},get_icon:function(cls){return $('<span/>').addClass('fa '+cls);},datagrid_resource_cell_styler:function(){return'background-color:#ededed';},status_formatter:function(status){if(status){var span=$('<span/>').html(status.title);span.addClass('status-label '+status.key);return $('<div/>').append(span).html();}},account_item_type_formatter:function(item_type){if(item_type){var span=$('<span/>').addClass('fa mr05');var title=$('<span/>').html(item_type.title);switch(item_type.key){case'revenue':span.addClass('fa-long-arrow-right');break;case'expenses':span.addClass('fa-long-arrow-left');break;default:span.addClass('fa-arrows-h');break;}
return $('<div/>').append(span).append(title).html();}},format_download_link:function(url){var span=$('<span/>').addClass('fa fa-download');var a=$('<a target="_blank"/>').attr('href',url).append(span);return $('<div/>').append(a).html();},is_undefined:function(val){return typeof(val)=='undefined';}});baka.ns('kara.ui.forms',{show_status_bar_info:function(status_bar,info_type,message){var icon=$('<i>');if(info_type=='error'){status_bar.addClass('error');icon.attr('class','fa fa-exclamation-circle fa-lg');}
if(info_type=='info'){status_bar.removeClass('error');icon.attr('class','fa fa-info-circle fa-lg');}
if(info_type=='success'){status_bar.removeClass('error');icon.attr('class','fa fa-check-circle fa-lg');}
if(info_type=='loading'){status_bar.removeClass('error');icon.attr('class','fa fa-spinner fa-spin fa-lg');}
status_bar.html(icon).append('&nbsp;'+message);},is_form_errors:function(errors){if(!kara.ui.helpers.is_undefined(errors))
return true;return false;},show_form_errors:function(form,errors){var self=this;if(self.is_form_errors(errors)){$.each(errors,function(input_name,error){self.set_field_error(form,input_name,error);});}},set_field_error:function(form,input_name,error){var input_selector="input[name='"+input_name+"']";var selector="[data-name='"+input_name+"']";form.find(input_selector).addClass('_invalid');form.find(selector+' span').html(error);form.find(selector+' i').tooltip({content:error,position:'right'});},clear_form_errors:function(form){form.find('.inputfield ._invalid').removeClass('_invalid');},submit:function(form){var self=this;form.form('submit',{url:form.attr('action'),success:function(data){var json=$.parseJSON(data);console.log(json);self.clear_form_errors(form);if(!kara.ui.helpers.is_undefined(json.error_message)){self.show_form_errors(form,json.errors);}else{if(!kara.ui.helpers.is_undefined(json.redirect)){window.location.href=json.redirect;return;}
}
},onSubmit:function(){console.log('form[onSubmit] ---');},onLoadSuccess:function(){return false;},onLoadError:function(){console.log('form[onLoadError] ---');}});}});